<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gamechooser 2</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="normalize.css">
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="styles.css">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap" rel="stylesheet">
      </head>
    <header>
        <div id="error_div" style="display:none"></div>
        <div id="main_nav_div">
            <button class="main_nav_button" onclick="show_sessions()">Sessions</button>
            <button class="main_nav_button" onclick="show_collection()">Collection</button>
            <button class="main_nav_button" onclick="show_add()">Add</button>
            <button class="main_nav_button" onclick="show_randomizer()">Randomizer</button>
            <button class="main_nav_button" onclick="show_stats()">Stats</button>
        </div>
    </header>
    <body>
        <div id="login_div" style="display:none">
            <label for="login_screen_secret">Password:</label>
            <input type="password" id="login_screen_secret">
            <button onclick="login_screen_submit()">Log in</button>
        </div>
        <div id="sessions_div" style="display:none">
            <h1 id="sessions_header" class="page_header">Sessions</h1>
            <div class="filter_div">
                <h2>Filter</h2>
                <ul class="checkbox_list">
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_active" checked>
                        <label for="sessions_screen_filter_active">Active only</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_memorable">
                        <label for="sessions_screen_filter_memorable">Memorable only</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_year_enable">
                        <label for="sessions_screen_filter_year_enable">Limit to year:</label>
                        <input type="number" id="sessions_screen_filter_year">
                    </li>
                </ul>
                <button onclick="session_screen_apply_filter()">Apply filters</button>
            </div>
            <div id="session_screen_session_list"></div>
        </div>
        <div id="collection_div" style="display:none">
            <h1 id="collection_header" class="page_header">Collection</h1>
            <div class="filter_div">
                <input type="text" id="collection_search_input" onkeypress="collection_search_box_keypress(event)">
                <button onclick="collection_screen_search()">Search collection</button>
            </div>
            <div id="collection_screen_game_list"></div>
        </div>
        <div id="add_div" style="display:none">
            <h1 class="page_header">Add to collection</h1>
            <div class="filter_div">
                <input type="text" id="add_screen_name_search_input", onkeypress="add_screen_search_igdb_keypress(event)">
                <button onclick="add_screen_search_igdb()">Search IGDB</button>
                <ul class="checkbox_list">
                    <li>
                        <input type="checkbox" id="add_screen_games_only" checked>
                        <label for="add_screen_games_only">Games only (no DLC, etc)</label>
                    </li>
                </ul>
                <hr>
                or, <button onclick="add_screen_add_custom()">add a game manually</button>
            </div>
            <div id="add_screen_search_igdb_output"></div>
        </div>
        <div id="randomizer_div" style="display:none">
            <h1 class="page_header">Randomizer</h1>
            <div id="randomizer_options_div" class="filter_div">
                <h2>Filter</h2>
                <ul class="checkbox_list">
                    <li>
                        <input type="checkbox" id="randomizer_screen_couch">
                        <label for="randomizer_screen_couch">Couch playable</label>
                    </li>
                    <li>
                        <input type="checkbox" id="randomizer_screen_portable">
                        <label for="randomizer_screen_portable">Portable playable</label>
                    </li>
                    <li>
                        <input type="checkbox" id="randomizer_screen_allow_unowned">
                        <label for="randomizer_screen_allow_unowned">Allow unowned games</label>
                    </li>
                </ul>
                <p>
                    <label for="randomizer_screen_jp_practice">Japanese practice: </label>
                    <select id="randomizer_screen_jp_practice">
                        <option value="any">Any</option>
                        <option value="require_true">Require tag</option>
                        <option value="require_false">Require no tag</option>
                    </select>
                </p>
                <button onclick="randomizer_screen_start()">Start choosin'</button>
            </div>
            <div id="randomizer_game_div" class="game_in_list">
                <h3 id="randomizer_game_title"></h3>
                <div class="game_in_list_columns">
                    <img id="randomizer_game_cover">
                    <div class="game_in_list_info">
                        <p id="randomizer_game_via"></p>
                        <a id="randomizer_game_igdb_link" target="_blank" rel="noopener noreferrer">IGDB page â§‰</a>
                        <button onclick="randomizer_pick_current_game()">Start this game!</button>
                        <button onclick="randomizer_pass_current_game()">Pass this game :(</button>
                        <button onclick="randomizer_push_current_game()">Push to later</button>
                        <button onclick="randomizer_retire_current_game()">Retire</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="stats_div" style="display:none">
            <p id="stats_total_selectable">Total selectable games: </p>
            <p id="stats_owned_selectable">Owned selectable games: </p>
            <p id="stats_unowned_selectable">Unowned selectable games: </p>
        </div>
        <div id="game_details_div" style="display:none">
            <h1 id="game_details_title"></h1>
            <img id="game_details_cover_art"></img>
            <div id="game_details_info">
                <p id="game_details_release_date"></p>
                <p id="game_details_via"></p>
                <div id="game_details_tags_and_own"></div>
                <button id="game_details_edit" onclick="game_details_edit()">Edit</button>
                <button id="game_details_reset" onclick="game_details_reset()">Reset choose state</button>
            </div>
        </div>
        <div id="game_edit_div" style="display:none">
            <h1 id="game_edit_header" class="page_header">Add Game</h1>

            <img id="game_edit_cover_art"></img>

            <div id="game_edit_info">
                <label for="game_edit_title">Title: </label>
                <input type="text" id="game_edit_title">
                <br>
                <label for="game_edit_release_date">Release date: </label>
                <input type="date" id="game_edit_release_date">

                <h2>Custom info</h2>
                <div id="game_edit_custom_info">
                    <label for="game_edit_via">Via:</label>
                    <input type="text" id="game_edit_via">

                    <h3>Tags</h3>
                    <div id="game_edit_tags">
                    </div>
                    <h3>Owned on</h3>
                    <div id="game_edit_own">
                    </div>
                </div>

                <h2>Choose state</h2>
                <div id="game_edit_choose_state">
                    <label for="game_edit_next_valid_proposal_date">Next valid choose date: </label>
                    <input type="date" id="game_edit_next_valid_proposal_date">
                    <br>
                    <label for="game_edit_passes">Number of passes</label>
                    <input type="number" id="game_edit_passes">
                    <ul class="checkbox_list">
                        <li>
                            <input type="checkbox" id="game_edit_retired">
                            <label for="game_edit_retired">Retired</label>
                        </li>
                        <li>
                            <input type="checkbox" id="game_edit_ignore_passes">
                            <label for="game_edit_ignore_passes">Ignore passes during randomizer</label>
                        </li>
                    </ul>
                </div>
            </div>
            <button id="game_edit_submit" onclick="edit_screen_submit()">Add Game</button>
        </div>
        <div id="result_div" style="display:none">
            <p id="result_message"></p>
        </div>
        <div id="loading_overlay" style="display:none">
        </div>
        <div id="loading_message" style="display:none">
            <p>Communicating with server...</p>
            <img src="postmoogle.gif">
        </div>
    </body>
    <script>
        function collection_search_box_keypress(e) {
            var key = e.keyCode || e.which;
            if(key == 13) {
                collection_screen_search();
            }
        }
        function add_screen_search_igdb_keypress(e) {
            var key = e.keyCode || e.which;
            if(key == 13) {
                add_screen_search_igdb();
            }
        }
    </script>
    <script type="module">
        import init, {
            initial_load,
            login_screen_submit,
            show_sessions,
            show_collection,
            show_add,
            show_randomizer,
            show_stats,
            add_screen_search_igdb,
            add_screen_add_result,
            add_screen_add_custom,
            edit_screen_submit,
            collection_screen_search,
            collection_screen_view_details,
            collection_screen_edit_game,
            collection_screen_start_session,
            session_screen_finish_session,
            session_screen_apply_filter,
            randomizer_screen_start,
            randomizer_pick_current_game,
            randomizer_pass_current_game,
            randomizer_push_current_game,
            randomizer_retire_current_game,
            game_details_edit,
            game_details_reset,
        } from './rs-wasm-bindgen-output/gamechooser2_client.js';

        async function run() {
            console.log("await init()");
            await init();
            window.initial_load = initial_load;
            window.login_screen_submit = login_screen_submit;
            window.show_sessions = show_sessions;
            window.show_collection = show_collection;
            window.show_add = show_add;
            window.show_randomizer = show_randomizer;
            window.show_stats = show_stats;
            window.add_screen_search_igdb = add_screen_search_igdb;
            window.add_screen_add_result = add_screen_add_result;
            window.add_screen_add_custom = add_screen_add_custom;
            window.edit_screen_submit = edit_screen_submit;
            window.collection_screen_search = collection_screen_search;
            window.collection_screen_view_details = collection_screen_view_details;
            window.collection_screen_edit_game = collection_screen_edit_game;
            window.collection_screen_start_session = collection_screen_start_session;
            window.session_screen_finish_session = session_screen_finish_session;
            window.session_screen_apply_filter = session_screen_apply_filter;
            window.randomizer_screen_start = randomizer_screen_start;
            window.randomizer_pick_current_game = randomizer_pick_current_game;
            window.randomizer_pass_current_game = randomizer_pass_current_game;
            window.randomizer_push_current_game = randomizer_push_current_game;
            window.randomizer_retire_current_game = randomizer_retire_current_game;
            window.game_details_edit = game_details_edit;
            window.game_details_reset = game_details_reset;
            console.log("bindings set");

            initial_load();
        }

        run();
    </script>
</html>
