<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gamechooser 2</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="normalize.css">
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="styles.css">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap" rel="stylesheet">
      </head>
    <header>
        <div id="main_nav_div">
            <button class="main_nav_button" onclick="show_sessions()">Sessions</button>
            <button class="main_nav_button" onclick="show_collection()">Collection</button>
            <button class="main_nav_button" onclick="show_full_collection()">Full</button>
            <button class="main_nav_button" onclick="show_add()">Add</button>
            <button class="main_nav_button" onclick="show_randomizer()">Randomizer</button>
            <button class="main_nav_button" onclick="show_stats()">Stats</button>
            <button class="main_nav_button" onclick="show_config()">Config</button>
        </div>
    </header>
    <body>
        <div id="login_div" style="display:none">
            <label for="login_screen_secret">Password:</label>
            <input type="password" id="login_screen_secret">
            <button onclick="login_screen_submit()">Log in</button>
        </div>
        <div id="sessions_div" style="display:none">
            <h1 id="sessions_header" class="page_header">Sessions</h1>
            <div class="filter_div">
                <h2>Filter</h2>
                <ul class="checkbox_list">
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_active" checked>
                        <label for="sessions_screen_filter_active">Active only</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_memorable">
                        <label for="sessions_screen_filter_memorable">Memorable only</label>
                    </li>
                    <li>
                        <input type="checkbox" id="sessions_screen_filter_year_enable">
                        <label for="sessions_screen_filter_year_enable">Limit to year:</label>
                        <input type="number" id="sessions_screen_filter_year">
                    </li>
                </ul>
                <button onclick="session_screen_apply_filter()">Apply filters</button>
            </div>
            <div id="session_screen_session_list"></div>
        </div>
        <div id="collection_div" style="display:none">
            <h1 id="collection_header" class="page_header">Collection</h1>
            <div class="filter_div">
                <input type="text" id="collection_search_input" onkeypress="collection_search_box_keypress(event)">
                <button onclick="collection_screen_search()">Search collection</button>
            </div>
            <div class="update_div">
                <button onclick="update_igdb_games()">Update IGDB games</button>
            </div>
            <div id="collection_screen_game_list"></div>
        </div>
        <div id="full_collection_div" style="display:none">
            <h1 id="full_collection_header" class="page_header">Full collection</h1>
            <div class="filter_div">
                <p>
                    <label for="full_collection_filter">Filter: </label>
                    <select id="full_collection_filter" onchange="show_full_collection()">
                        <option value="live">Only Alive</option>
                        <option value="all">All</option>
                        <option value="owned_dead_unplayed">Owned But Abandoned</option>
                        <option value="live_released_no_hltb">Needs HLTB Data</option>
                        <option value="not_released">Not Released</option>
                    </select>
                </p>
            </div>
            <div id="full_collection_screen_game_list"></div>
        </div>
        <div id="add_div" style="display:none">
            <h1 class="page_header">Add to collection</h1>
            <div class="filter_div">
                <input type="text" id="add_screen_name_search_input", onkeypress="add_screen_search_igdb_keypress(event)">
                <button onclick="add_screen_search_igdb()">Search IGDB</button>
                <ul class="checkbox_list">
                    <li>
                        <input type="checkbox" id="add_screen_games_only" checked>
                        <label for="add_screen_games_only">Games only (no DLC, etc)</label>
                    </li>
                </ul>
                <hr>
                or, <button onclick="add_screen_add_custom()">add a game manually</button>
            </div>
            <div id="add_screen_search_igdb_output"></div>
        </div>
        <div id="randomizer_div" style="display:none">
            <h1 class="page_header">Randomizer</h1>
            <div id="randomizer_options_div" class="filter_div">
                <div style="padding-bottom:1vh">
                    <input type="checkbox" id="randomizer_pick_up_and_play_mode"
                        onchange="randomizer_pick_up_and_play_mode_changed()">
                    <label for="randomizer_pick_up_and_play_mode">Pick up and play mode</label>
                </div>
                <div id="randomizer_options_filter_div">
                    <h2>Filter</h2>
                    <ul class="checkbox_list">
                        <li>
                            <input type="checkbox" id="randomizer_screen_couch">
                            <label for="randomizer_screen_couch">Couch playable</label>
                        </li>
                        <li>
                            <input type="checkbox" id="randomizer_screen_portable">
                            <label for="randomizer_screen_portable">Portable playable</label>
                        </li>
                        <li>
                            <input type="checkbox" id="randomizer_screen_allow_unowned">
                            <label for="randomizer_screen_allow_unowned">Allow unowned games</label>
                        </li>
                        <li>
                            <input type="checkbox" id="randomizer_screen_only_firsts" checked>
                            <label for="randomizer_screen_only_firsts">Only games never played before</label>
                        </li>
                        <li>
                            <input type="checkbox" id="randomizer_screen_allow_retro">
                            <label for="randomizer_screen_allow_retro">Allow retro</label>
                        </li>
                    </ul>
                    <p>
                        <label for="randomizer_screen_jp_practice">Japanese practice: </label>
                        <select id="randomizer_screen_jp_practice">
                            <option value="any">Any</option>
                            <option value="require_true">Require tag</option>
                            <option value="require_false">Require no tag</option>
                        </select>
                    </p>
                    <p>
                        <label for="randomizer_screen_game_length">Game length: </label>
                        <select id="randomizer_screen_game_length">
                            <option value="any">Any</option>
                            <option value="8">~8 hours</option>
                            <option value="12">~12 hours</option>
                            <option value="20">~20 hours</option>
                        </select>
                    </p>
                </div>
                <button onclick="randomizer_screen_start()">Start choosin'</button>
            </div>
            <div id="randomizer_game_div">
                <div id="randomizer_game_card"></div>
            </div>
        </div>
        <div id="stats_div" style="display:none">
            <h1 class="page_header">Stats</h1>
            <div id="stats_container">
            </div>
        </div>
        <div id="config_div" style="display:none">
            <label for="config_live_max_passes" title="Max passes for game to be considered 'live' and selectable by the randomizer algorithm.">Live Max Passes:</label>
            <input type="number" min=0, max=100 id="config_live_max_passes">
        </div>
        <div id="game_details_div" style="display:none">
            <div id="game_details_card"></div>
            <div id="game_details_sessions">
            </div>
        </div>
        <div id="game_edit_div" style="display:none">
            <h1 id="game_edit_header" class="page_header">Add Game</h1>

            <img id="game_edit_cover_art"></img>

            <div id="game_edit_info">
                <label for="game_edit_title">Title: </label>
                <input type="text" id="game_edit_title">
                <br>
                <label for="game_edit_release_date_type">Release date: </label>
                <select id="game_edit_release_date_type" onchange="release_date_type_changed(this)">
                    <option value="unknown_unreleased">Unknown (unreleased)</option>
                    <option value="unknown_released">Unknown (released)</option>
                    <option value="known">Known</option>
                </select>
                <input type="date" id="game_edit_release_date_date" display:none>

                <label for="game_edit_how_long_to_beat_type">How long to beat: </label>
                <select id="game_edit_how_long_to_beat_type" onchange="how_long_to_beat_type_changed(this)">
                    <option value="unknown">Unknown</option>
                    <option value="manual">Manual (hours)</option>
                    <option value="cannot_be_beaten">Cannot be Beaten</option>
                </select>
                <input type="number" min=0 max=9999 id="game_edit_how_long_to_beat_hours" display:none>

                <h2>Custom info</h2>
                <div id="game_edit_custom_info">
                    <label for="game_edit_via">Via:</label>
                    <input type="text" id="game_edit_via">

                    <h3>Tags</h3>
                    <div id="game_edit_tags">
                    </div>
                    <h3>Owned on</h3>
                    <div id="game_edit_own">
                    </div>

                    <h3>Advanced</h3>
                    <ul class="checkbox_list">
                        <li>
                            <input type="checkbox" id="game_edit_phantom_session">
                            <label for="game_edit_phantom_session" title="Always treat this game as having at least one session even if there's no record (likely due to past lost data)">Phantom session</label>
                        </li>
                        <li class="danger">
                            <input type="checkbox" id="game_edit_archive">
                            <label for="game_edit_archive">Archive (!GAME WILL NO LONGER APPEAR IN UI!)</label>
                        </li>
                    </ul>
                </div>

                <h2>Choose state</h2>
                <div id="game_edit_choose_state">
                    <label for="game_edit_next_valid_proposal_date">Next valid choose date: </label>
                    <input type="date" id="game_edit_next_valid_proposal_date">
                    <br>
                    <label for="game_edit_passes">Number of passes</label>
                    <input type="number" id="game_edit_passes">
                    <ul class="checkbox_list">
                        <li>
                            <input type="checkbox" id="game_edit_retired">
                            <label for="game_edit_retired">Retired</label>
                        </li>
                        <li>
                            <input type="checkbox" id="game_edit_ignore_passes">
                            <label for="game_edit_ignore_passes">Ignore passes during randomizer</label>
                        </li>
                    </ul>
                </div>
            </div>
            <button id="game_edit_submit" onclick="edit_screen_submit()">Add Game</button>
        </div>
        <div id="result_div" style="display:none">
            <p id="result_message"></p>
        </div>
        <div id="popup_overlay" style="display:none">
        </div>
        <div id="loading_message" style="display:none">
            <p>Communicating with server...</p>
            <img src="postmoogle.gif">
        </div>
        <div id="error_message" style="display:none">
            <h3>Error</h3>
            <p id="error_message_content"></p>
            <hr>
            <p>I'm a very simple app and can't recover from errors, please refresh me.</p>
        </div>
    </body>
    <script>
        function collection_search_box_keypress(e) {
            var key = e.keyCode || e.which;
            if(key == 13) {
                collection_screen_search();
            }
        }
        function add_screen_search_igdb_keypress(e) {
            var key = e.keyCode || e.which;
            if(key == 13) {
                add_screen_search_igdb();
            }
        }
    </script>
    <script type="module">
        import init, {
            initial_load,
            login_screen_submit,
            show_sessions,
            show_collection,
            show_full_collection,
            show_add,
            show_randomizer,
            show_stats,
            show_config,
            add_screen_search_igdb,
            add_screen_add_result,
            add_screen_add_custom,
            release_date_type_changed,
            how_long_to_beat_type_changed,
            edit_screen_submit,
            collection_screen_search,
            update_igdb_games,
            game_card_view_details,
            edit_cached_game,
            start_session,
            session_screen_finish_session,
            session_screen_apply_filter,
            randomizer_pick_up_and_play_mode_changed,
            randomizer_screen_start,
            randomizer_pick_current_game,
            randomizer_pass_current_game,
            randomizer_push_current_game,
            randomizer_retire_current_game,
            randomizer_next_game_no_state_change,
            game_details_edit,
            game_details_reset,
        } from './rs-wasm-bindgen-output/gamechooser2_client.js';

        async function run() {
            console.log("await init()");
            await init();
            window.initial_load = initial_load;
            window.login_screen_submit = login_screen_submit;
            window.show_sessions = show_sessions;
            window.show_collection = show_collection;
            window.show_full_collection = show_full_collection;
            window.show_add = show_add;
            window.show_randomizer = show_randomizer;
            window.show_stats = show_stats;
            window.show_config = show_config;
            window.add_screen_search_igdb = add_screen_search_igdb;
            window.add_screen_add_result = add_screen_add_result;
            window.add_screen_add_custom = add_screen_add_custom;
            window.release_date_type_changed = release_date_type_changed;
            window.how_long_to_beat_type_changed = how_long_to_beat_type_changed ;
            window.edit_screen_submit = edit_screen_submit;
            window.collection_screen_search = collection_screen_search;
            window.update_igdb_games = update_igdb_games;
            window.game_card_view_details = game_card_view_details;
            window.edit_cached_game = edit_cached_game;
            window.start_session = start_session;
            window.session_screen_finish_session = session_screen_finish_session;
            window.session_screen_apply_filter = session_screen_apply_filter;
            window.randomizer_pick_up_and_play_mode_changed = randomizer_pick_up_and_play_mode_changed;
            window.randomizer_screen_start = randomizer_screen_start;
            window.randomizer_pick_current_game = randomizer_pick_current_game;
            window.randomizer_pass_current_game = randomizer_pass_current_game;
            window.randomizer_push_current_game = randomizer_push_current_game;
            window.randomizer_retire_current_game = randomizer_retire_current_game;
            window.randomizer_next_game_no_state_change = randomizer_next_game_no_state_change;
            window.game_details_edit = game_details_edit;
            window.game_details_reset = game_details_reset;
            console.log("bindings set");

            initial_load();
        }

        run();
    </script>
</html>
